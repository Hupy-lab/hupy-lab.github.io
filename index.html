<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSDKP Belawan</title>
    <!-- Bootstrap CSS untuk UI modern -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons untuk ikon -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { box-shadow: 0 4px 8px rgba(0,0,0,0.1); border: none; animation: fadeIn 1s ease-in; }
        .btn-whatsapp { background-color: #d32548; border-color: #d32548; color: white; transition: all 0.3s ease; }
        .btn-whatsapp:hover { background-color: #18b765; border-color: #18b765; transform: scale(1.05); box-shadow: 0 0 10px rgba(24, 183, 101, 0.5); }
        .navbar { box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .table-responsive { margin-top: 20px; }
        .alert { border-radius: 10px; animation: pulse 0.5s ease-in-out; }
        .navbar-brand { display: flex; align-items: center; flex-wrap: wrap; }
        .navbar-brand img { height: 80px; margin-right: 10px; }
        .navbar-brand span { font-size: 1rem; }
        #dataCard { animation: slideInUp 0.8s ease-out; }
        /* Keyframes untuk animasi */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        /* Media query untuk tablet dan smartphone besar (768px ke bawah) */
        @media (max-width: 768px) {
            .navbar-brand img { height: 50px; margin-bottom: 5px; }
            .navbar-brand span { font-size: 0.9rem; display: block; }
            .navbar-brand { flex-direction: column; text-align: center; }
            .container { padding-left: 10px; padding-right: 10px; }
            .card { margin-bottom: 15px; }
            .table-responsive { font-size: 0.85rem; }
            .btn-whatsapp { font-size: 0.9rem; padding: 8px 12px; }
        }
        /* Media query untuk smartphone kecil (576px ke bawah) */
        @media (max-width: 576px) {
            .navbar-brand img { height: 40px; margin-bottom: 3px; }
            .navbar-brand span { font-size: 0.8rem; }
            .container { padding-left: 5px; padding-right: 5px; }
            .card { margin-bottom: 10px; padding: 10px; }
            .card-header h4 { font-size: 1.1rem; }
            .table-responsive { font-size: 0.8rem; overflow-x: auto; } /* Scroll horizontal */
            .btn-whatsapp { width: 100%; font-size: 0.85rem; padding: 6px 10px; margin-bottom: 5px; } /* Full width */
            .form-label { font-size: 0.9rem; }
            .alert { font-size: 0.85rem; padding: 8px; }
            footer p { font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <!-- Navbar Header dengan Logo DJ PSDKP -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <img src="Logo_KKP.png" alt="Logo KKP">
                <span>KEMENTERIAN KELAUTAN DAN PERIKANAN</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <img src="Logo_PSDKP.png" alt="Logo PSDKP" height="80" class="d-none d-md-block">
                        <img src="Logo_PSDKP.png" alt="Logo PSDKP" height="50" class="d-block d-md-none">
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-3"> <!-- Margin top dikurangi untuk smartphone -->
        <!-- Card Utama untuk Upload -->
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10 col-sm-12 col-12"> <!-- Full width di smartphone -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white text-center">
                        <h4 class="mb-0"><i class="bi bi-file-earmark-spreadsheet me-2"></i>Upload file Excel</h4>
                    </div>
                    <div class="card-body">
                        <p class="text-muted text-center"></p>
                        
                        <!-- Form Upload -->
                        <form>
                            <div class="mb-3">
                                <label for="excelFile" class="form-label fw-semibold"><i class="bi bi-upload me-1"></i>Pilih File Excel</label>
                                <input type="file" class="form-control" id="excelFile" accept=".xlsx,.xls" required>
                                <div class="form-text">Pastikan file memiliki header yang tepat untuk kolom.</div>
                            </div>
                            <div class="d-grid">
                                <button type="button" class="btn btn-whatsapp btn-lg" id="processBtn" onclick="processExcel()"><i class="bi bi-play-circle-fill me-2"></i>Proses Excel</button>
                            </div>
                        </form>
                        
                        <!-- Alert Box untuk Feedback -->
                        <div id="alertBox" class="alert mt-3" style="display: none;" role="alert"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card untuk Tabel Data -->
        <div class="row justify-content-center">
            <div class="col-lg-10 col-md-12 col-sm-12 col-12"> <!-- Full width di smartphone -->
                <div class="card" id="dataCard" style="display: none;">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-table me-2"></i>Data dari Excel</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover align-middle">
                                <thead class="table-success">
                                    <tr>
                                        <th scope="col">Nama Pengawas</th>
                                        <th scope="col">Nomor</th>
                                        <th scope="col">Pesan</th>
                                        <th scope="col" class="text-center">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="dataBody">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            <small class="text-muted">Klik "Kirim" untuk membuka aplikasi WhatsApp langsung dengan pesan pra-disi.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Sederhana -->
        <footer class="text-center mt-3 py-2 border-top"> <!-- Padding dikurangi -->
            <p class="mb-0 text-muted">&copy;Stasiun Pengawasan Sumber Daya Kelautan dan Perikanan Belawan.</p>
        </footer>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SheetJS untuk parsing Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        let excelData = [];

        // Fungsi untuk menampilkan alert
        function showAlert(message, type = 'info') {
            const alertBox = document.getElementById('alertBox');
            alertBox.className = `alert alert-${type}`;
            alertBox.innerHTML = `<i class="bi bi-info-circle me-2"></i>${message}`;
            alertBox.style.display = 'block';
            setTimeout(() => alertBox.style.display = 'none', 5000);
        }

        // Fungsi untuk memproses file Excel dengan loading animasi
        function processExcel() {
            const file = document.getElementById('excelFile').files[0];
            if (!file) {
                showAlert('Silakan pilih file Excel terlebih dahulu!', 'warning');
                return;
            }

            // Tambahkan spinner loading
            const btn = document.getElementById('processBtn');
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Memproses...';
            btn.disabled = true;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                const headers = excelData[0];
                const namaIndex = headers.indexOf('Nama Pengawas');
                const nomorIndex = headers.indexOf('Nomor');
                const pesanIndex = headers.indexOf('Pesan');

                if (namaIndex === -1 || nomorIndex === -1 || pesanIndex === -1) {
                    showAlert('File Excel harus memiliki kolom "Nama Pengawas", "Nomor", dan "Pesan"!', 'danger');
                    btn.innerHTML = '<i class="bi bi-play-circle-fill me-2"></i>Proses Excel';
                    btn.disabled = false;
                    return;
                }

                const tbody = document.getElementById('dataBody');
                tbody.innerHTML = '';
                for (let i = 1; i < excelData.length; i++) {
                    const row = excelData[i];
                    const nama = row[namaIndex] || 'N/A';
                    const nomor = row[nomorIndex];
                    const pesan = row[pesanIndex];
                    if (nomor && pesan) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${nama}</td>
                            <td>${nomor}</td>
                            <td>${pesan}</td>
                            <td class="text-center">
                                <button class="btn btn-whatsapp btn-sm" onclick="sendToWhatsApp('${nomor}', '${encodeURIComponent(pesan)}')">
                                    <i class="bi bi-send me-1"></i>Kirim
                                </button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    }
                }
                document.getElementById('dataCard').style.display = 'block';
                showAlert('Data Excel berhasil diproses! Gulir ke bawah untuk melihat tabel.', 'success');
                // Reset button
                btn.innerHTML = '<i class="bi bi-play-circle-fill me-2"></i>Proses Excel';
                btn.disabled = false;
            };
            reader.readAsArrayBuffer(file);
        }

        // Fungsi untuk kirim ke WhatsApp (deep link ke app)
        function sendToWhatsApp(phone, message) {
            // Gunakan deep link untuk aplikasi WhatsApp
            const url = `whatsapp://send?phone=${phone}&text=${message}`;
            window.location.href = url; // Langsung buka app, bukan tab baru
            showAlert('Mencoba membuka aplikasi WhatsApp. Jika tidak bekerja, pastikan app terinstall!', 'info');
        }
    </script>
</body>
</html>